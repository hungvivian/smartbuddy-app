<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartBuddy Êô∫Â≠¶ÂÆù - AI-Powered Smart Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        .kid-friendly-bg {
            background: linear-gradient(135deg, 
                #FFF3E0 0%,   /* Warm cream */
                #FFE0B2 25%,  /* Light orange */
                #E1F5FE 50%,  /* Soft blue */
                #F3E5F5 75%,  /* Light purple */
                #E8F5E8 100%  /* Gentle green */
            );
            animation: gentle-float 6s ease-in-out infinite;
        }
        
        @keyframes gentle-float {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .cartoon-card {
            background: linear-gradient(145deg, 
                rgba(255, 255, 255, 0.9) 0%,
                rgba(255, 248, 240, 0.95) 100%
            );
            backdrop-filter: blur(10px);
            box-shadow: 
                0 20px 40px rgba(255, 165, 0, 0.15),
                0 8px 25px rgba(147, 51, 234, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .fun-button {
            background: linear-gradient(45deg, #FF9A56, #FF6B9D);
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
            transition: all 0.3s ease;
            border: none;
        }
        
        .fun-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        }
        
        .secondary-button {
            background: linear-gradient(45deg, #4ECDC4, #45B7D1);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }
        
        .secondary-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }
        
        .robot-emoji {
            filter: drop-shadow(0 4px 8px rgba(255, 165, 0, 0.3));
            animation: bounce-robot 2s ease-in-out infinite;
        }
        
        @keyframes bounce-robot {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .star-decoration {
            animation: twinkle 3s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 10s infinite ease-in-out;
        }
        
        .shape:nth-child(1) { left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { left: 20%; animation-delay: 2s; }
        .shape:nth-child(3) { left: 70%; animation-delay: 4s; }
        .shape:nth-child(4) { left: 80%; animation-delay: 6s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); }
            50% { transform: translateY(-100vh) rotate(180deg); }
        }
    </style>
</head>
<body class="font-sans kid-friendly-bg min-h-screen relative">
    
    <!-- Floating Background Shapes -->
    <div class="floating-shapes">
        <div class="shape text-6xl">üöÄ</div>
        <div class="shape text-5xl">‚≠ê</div>
        <div class="shape text-4xl">üéØ</div>
        <div class="shape text-5xl">üé®</div>
    </div>
    
    <!-- Welcome Screen -->
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="cartoon-card rounded-3xl p-8 w-full max-w-md text-center relative overflow-hidden">
            <!-- Decorative stars -->
            <div class="absolute top-4 left-4 star-decoration text-yellow-400 text-2xl">‚≠ê</div>
            <div class="absolute top-6 right-6 star-decoration text-pink-400 text-xl">‚ú®</div>
            <div class="absolute bottom-6 left-6 star-decoration text-blue-400 text-xl">üí´</div>
            
            <div class="robot-emoji text-6xl mb-4">ü§ñ</div>
            <h1 class="text-3xl font-bold text-orange-600 mb-2">ü§ñ SmartBuddy</h1>
            <h2 class="text-xl font-semibold text-blue-500 mb-4">Êô∫Â≠¶ÂÆù</h2>
            <p class="text-gray-700 mb-2 font-medium">AI-Powered Smart Learning Platform</p>
            <p class="text-gray-600 mb-6 text-sm">AIÊô∫ËÉΩÂ≠¶‰π†Âπ≥Âè∞<br>Testing Airtable Connection...</p>
            
            <div id="connectionStatus" class="p-4 rounded-lg mb-6 bg-blue-50">
                <div class="text-lg font-semibold text-blue-800">üîÑ Testing Connection...</div>
                <div class="text-sm text-blue-600 mt-2">Please wait while we connect to your Airtable database</div>
            </div>
            
            <div class="space-y-4">
                <button onclick="testConnection()" class="w-full fun-button text-white py-3 px-6 rounded-xl font-semibold">
                    üîÑ Test Again
                </button>
                <button onclick="showFullApp()" class="w-full secondary-button text-white py-3 px-6 rounded-xl font-semibold">
                    üì± View Full App Demo
                </button>
            </div>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500">
                    ü§ñ Next-Generation Learning Technology<br>
                    Powered by AI & Gamification
                </p>
            </div>
        </div>
    </div>

    <script>
        // Your Airtable credentials
        const AIRTABLE_CONFIG = {
            baseId: 'appzbq4Zom94iCItg',
            apiKey: 'pat5tRFkAevnxWSCb.df7ccb343bab79699520ba7704fbd86b2a8d99a9678715a432b8f7fbf7587c70'
        };

        // Test Airtable connection
        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            
            try {
                statusDiv.innerHTML = `
                    <div class="text-lg font-semibold text-blue-800">üîÑ Testing Connection...</div>
                    <div class="text-sm text-blue-600 mt-2">Connecting to Base ID: ${AIRTABLE_CONFIG.baseId.substring(0, 10)}...</div>
                `;

                // Test Questions table
                const questionsUrl = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/Questions`;
                console.log('Testing URL:', questionsUrl);
                
                const response = await fetch(questionsUrl, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (response.ok) {
                    const data = await response.json();
                    const recordCount = data.records ? data.records.length : 0;
                    
                    console.log('Data received:', data);
                    console.log('Record count:', recordCount);

                    if (recordCount > 0) {
                        // SUCCESS - Found data
                        statusDiv.innerHTML = `
                            <div class="text-lg font-semibold text-green-800">‚úÖ CONNECTION SUCCESS!</div>
                            <div class="text-sm text-green-600 mt-2">
                                üìä Found ${recordCount} questions in your database<br>
                                üéâ Your Airtable is working perfectly!
                            </div>
                        `;
                        statusDiv.className = 'p-4 rounded-lg mb-6 bg-green-50';
                        
                    } else {
                        // SUCCESS but no data
                        statusDiv.innerHTML = `
                            <div class="text-lg font-semibold text-yellow-800">‚ö†Ô∏è CONNECTED BUT EMPTY</div>
                            <div class="text-sm text-yellow-600 mt-2">
                                ‚úÖ Connection works, but no questions found<br>
                                üìù Please add data to your Questions table
                            </div>
                        `;
                        statusDiv.className = 'p-4 rounded-lg mb-6 bg-yellow-50';
                    }
                } else {
                    // Connection failed
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    
                    if (response.status === 401) {
                        statusDiv.innerHTML = `
                            <div class="text-lg font-semibold text-red-800">üîë API KEY EXPIRED</div>
                            <div class="text-sm text-red-600 mt-2">
                                Your Airtable API key needs to be updated<br>
                                üìã Please generate a new API key from Airtable
                            </div>
                        `;
                        statusDiv.className = 'p-4 rounded-lg mb-6 bg-red-50';
                    } else {
                        statusDiv.innerHTML = `
                            <div class="text-lg font-semibold text-red-800">‚ùå CONNECTION FAILED</div>
                            <div class="text-sm text-red-600 mt-2">
                                Error ${response.status}: ${response.statusText}<br>
                                Check your credentials and table setup
                            </div>
                        `;
                        statusDiv.className = 'p-4 rounded-lg mb-6 bg-red-50';
                    }
                    
                    setTimeout(() => {
                        statusDiv.innerHTML = `
                            <div class="text-lg font-semibold text-blue-800">üéÆ SWITCHING TO DEMO MODE!</div>
                            <div class="text-sm text-blue-600 mt-2">
                                ‚ú® App will work with sample questions<br>
                                üéØ All features available for testing
                            </div>
                        `;
                        statusDiv.className = 'p-4 rounded-lg mb-6 bg-blue-50';
                    }, 2500);
                }

            } catch (error) {
                console.error('Network error:', error);
                
                statusDiv.innerHTML = `
                    <div class="text-lg font-semibold text-red-800">‚ùå NETWORK ERROR</div>
                    <div class="text-sm text-red-600 mt-2">
                        ${error.message}<br>
                        Check your internet connection
                    </div>
                `;
                statusDiv.className = 'p-4 rounded-lg mb-6 bg-red-50';
            }
        }

        // Global variables
        let userStats = {
            points: 0,
            level: 1,
            streak: 1,
            totalQuestionsAnswered: 0,
            correctAnswers: 0,
            lastLoginDate: new Date().toDateString(),
            selectedGrade: ''
        };

        // Show full app demo
        function showFullApp() {
            console.log('üöÄ Starting full app...');
            
            // Hide welcome screen and show main app
            document.body.innerHTML = `
                <body class="font-sans kid-friendly-bg min-h-screen relative">
                    <!-- Floating Background Shapes -->
                    <div class="floating-shapes">
                        <div class="shape text-6xl">üöÄ</div>
                        <div class="shape text-5xl">‚≠ê</div>
                        <div class="shape text-4xl">üéØ</div>
                        <div class="shape text-5xl">üé®</div>
                    </div>
                    
                    <!-- Header -->
                    <header class="bg-white/90 backdrop-blur-sm shadow-lg sticky top-0 z-50">
                        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="robot-emoji text-3xl">ü§ñ</div>
                                <div id="appHeader">
                                    <h1 class="text-xl font-bold text-orange-600">SmartBuddy</h1>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-600" id="userPoints">0</div>
                                    <div class="text-xs text-gray-600">Points</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600" id="userLevel">1</div>
                                    <div class="text-xs text-gray-600">Level</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl" id="streakFire">üî•</div>
                                    <div class="text-xs text-gray-600" id="streakCount">0 day streak</div>
                                </div>
                                <button onclick="showWelcome()" class="bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white w-12 h-12 rounded-full transition-all duration-300 hover:transform hover:scale-105 flex items-center justify-center text-2xl">
                                    üè†
                                </button>
                                <button onclick="showSettings()" class="bg-white hover:bg-gray-50 text-gray-600 border-2 border-gray-200 hover:border-gray-300 w-12 h-12 rounded-full transition-all duration-300 hover:transform hover:scale-105 flex items-center justify-center text-3xl shadow-sm">
                                    ‚öôÔ∏è
                                </button>
                            </div>
                        </div>
                    </header>

                    <!-- Main Content -->
                    <main class="max-w-6xl mx-auto px-4 py-8">
                        <!-- Welcome Section -->
                        <section id="welcomeSection" class="text-center mb-8">
                            <div class="cartoon-card rounded-3xl p-8 mb-8">
                                <h2 class="text-3xl font-bold text-gray-800 mb-4">
                                    Welcome to SmartBuddy! ü§ñ
                                </h2>
                                <p class="text-gray-600 mb-6">
                                    Ready to learn and earn points? Choose your learning adventure!
                                </p>
                                
                                <!-- Grade Selection -->
                                <div class="mb-6">
                                    <label class="block text-lg font-semibold mb-3">Please select your grade:</label>
                                    <select id="gradeSelect" class="text-base px-4 py-3 rounded-xl border-2 border-purple-200 focus:border-purple-400 bg-white w-full max-w-xs" onchange="saveSelectedGrade()">
                                        <option value="">Choose your grade</option>
                                        <option value="K1">üé® K1 (Ages 3-4)</option>
                                        <option value="K2">üåà K2 (Ages 4-5)</option>
                                        <option value="K3">üé≠ K3 (Ages 5-6)</option>
                                        <option value="Primary1">üìö Primary 1</option>
                                        <option value="Primary2">üî¢ Primary 2</option>
                                        <option value="Primary3">üß™ Primary 3</option>
                                        <option value="Primary4">üåü Primary 4</option>
                                        <option value="Primary5">üöÄ Primary 5</option>
                                        <option value="Primary6">üèÜ Primary 6</option>
                                    </select>
                                </div>

                                <!-- Subject Selection -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <button onclick="startQuiz('Math')" class="fun-button text-white py-4 px-6 rounded-xl font-semibold hover:scale-105 transition-transform">
                                        üî¢ Math
                                    </button>
                                    <button onclick="startQuiz('English')" class="secondary-button text-white py-4 px-6 rounded-xl font-semibold hover:scale-105 transition-transform">
                                        üìö English
                                    </button>
                                    <button onclick="startQuiz('Science')" class="bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white py-4 px-6 rounded-xl font-semibold transition-all duration-300 hover:transform hover:scale-105">
                                        üß™ Science
                                    </button>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <button onclick="showMiniGames()" class="group relative overflow-hidden bg-gradient-to-br from-pink-400 via-purple-400 to-red-500 hover:from-pink-500 hover:via-purple-500 hover:to-red-600 text-white py-6 px-6 rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 hover:transform hover:scale-105 border-2 border-white/20">
                                        <div class="relative z-10 flex flex-col items-center space-y-2">
                                            <div class="text-3xl">üéÆ</div>
                                            <div>Mini Games</div>
                                        </div>
                                    </button>
                                    <button onclick="showRewards()" class="group relative overflow-hidden bg-gradient-to-br from-yellow-400 via-orange-400 to-amber-500 hover:from-yellow-500 hover:via-orange-500 hover:to-amber-600 text-white py-6 px-6 rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 hover:transform hover:scale-105 border-2 border-white/20">
                                        <div class="relative z-10 flex flex-col items-center space-y-2">
                                            <div class="text-3xl">üéÅ</div>
                                            <div>View Rewards</div>
                                        </div>
                                    </button>
                                    <button onclick="showProgress()" class="group relative overflow-hidden bg-gradient-to-br from-indigo-400 via-blue-400 to-purple-500 hover:from-indigo-500 hover:via-blue-500 hover:to-purple-600 text-white py-6 px-6 rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 hover:transform hover:scale-105 border-2 border-white/20">
                                        <div class="relative z-10 flex flex-col items-center space-y-2">
                                            <div class="text-3xl">üìä</div>
                                            <div>My Progress</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- Quiz Section -->
                        <section id="quizSection" class="hidden">
                            <div class="cartoon-card rounded-3xl p-8">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-2xl font-bold text-gray-800">Challenge Time! üöÄ</h3>
                                    <button onclick="showWelcome()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 w-10 h-10 rounded-full flex items-center justify-center text-2xl">
                                        ‚úï
                                    </button>
                                </div>
                                
                                <!-- Quiz Progress -->
                                <div class="bg-gray-200 rounded-full h-3 mb-6">
                                    <div id="quizProgress" class="bg-gradient-to-r from-green-400 to-emerald-500 h-3 rounded-full transition-all duration-300" style="width: 20%"></div>
                                </div>
                                <div class="text-center mb-6">
                                    <span class="text-sm text-gray-600">Question <span id="currentQuestionNum">1</span> of <span id="totalQuestions">5</span></span>
                                </div>
                                
                                <!-- Quiz Content -->
                                <div id="quizContent">
                                    <!-- Question -->
                                    <div class="bg-blue-50 rounded-xl p-6 mb-6">
                                        <h4 class="text-lg font-semibold text-gray-800 mb-4" id="questionText">
                                            What is 2 + 3?
                                        </h4>
                                        
                                        <!-- Answer Options -->
                                        <div class="space-y-3" id="answerOptions">
                                            <button class="answer-option w-full text-left p-4 rounded-xl border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200" onclick="selectAnswer(0, this)">
                                                <span class="font-semibold text-blue-600 mr-3">A)</span> 4
                                            </button>
                                            <button class="answer-option w-full text-left p-4 rounded-xl border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200" onclick="selectAnswer(1, this)">
                                                <span class="font-semibold text-blue-600 mr-3">B)</span> 5
                                            </button>
                                            <button class="answer-option w-full text-left p-4 rounded-xl border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200" onclick="selectAnswer(2, this)">
                                                <span class="font-semibold text-blue-600 mr-3">C)</span> 6
                                            </button>
                                            <button class="answer-option w-full text-left p-4 rounded-xl border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200" onclick="selectAnswer(3, this)">
                                                <span class="font-semibold text-blue-600 mr-3">D)</span> 7
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Next Button -->
                                    <div class="text-center">
                                        <button id="nextButton" onclick="nextQuestion()" class="bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white py-3 px-8 rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300" disabled>
                                            Next Question ‚Üí
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Quiz Results -->
                                <div id="quizResults" class="hidden text-center">
                                    <div class="text-6xl mb-4">üéâ</div>
                                    <h4 class="text-2xl font-bold text-gray-800 mb-4">Challenge Complete!</h4>
                                    <div class="bg-green-50 rounded-xl p-6 mb-6">
                                        <div class="text-3xl font-bold text-green-600 mb-2" id="finalScore">4/5</div>
                                        <p class="text-gray-700">Great job! You earned <span id="pointsEarned" class="font-bold text-purple-600">40 points</span>!</p>
                                    </div>
                                    <div class="space-y-3">
                                        <button onclick="startNewQuiz()" class="w-full bg-gradient-to-r from-blue-400 to-purple-500 hover:from-blue-500 hover:to-purple-600 text-white py-3 px-6 rounded-xl font-semibold">
                                            üîÑ Try Another Challenge
                                        </button>
                                        <button onclick="showWelcome()" class="w-full secondary-button text-white py-3 px-6 rounded-xl font-semibold">
                                            üè† Back to Home
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Mini Games Section -->
                        <section id="miniGamesSection" class="hidden">
                            <div class="cartoon-card rounded-3xl p-8">
                                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">üéÆ Mini Games</h3>
                                <div class="bg-purple-50 rounded-xl p-6 text-center">
                                    <div class="text-5xl mb-4">üéØ</div>
                                    <p class="text-gray-700 mb-4">Fun mini games coming soon!</p>
                                    <button onclick="showWelcome()" class="secondary-button text-white py-3 px-6 rounded-xl font-semibold">
                                        üè† Back to Home
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- Rewards Section -->
                        <section id="rewardsSection" class="hidden">
                            <div class="cartoon-card rounded-3xl p-8">
                                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">üéÅ Rewards Store</h3>
                                <div class="bg-yellow-50 rounded-xl p-6 text-center">
                                    <div class="text-5xl mb-4">üíé</div>
                                    <p class="text-gray-700 mb-4">Amazing rewards await you!</p>
                                    <button onclick="showWelcome()" class="secondary-button text-white py-3 px-6 rounded-xl font-semibold">
                                        üè† Back to Home
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- Progress Section -->
                        <section id="progressSection" class="hidden">
                            <div class="cartoon-card rounded-3xl p-8">
                                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">üìä My Progress</h3>
                                <div class="bg-green-50 rounded-xl p-6 text-center">
                                    <div class="text-5xl mb-4">üìà</div>
                                    <p class="text-gray-700 mb-4">Track your learning journey!</p>
                                    <button onclick="showWelcome()" class="secondary-button text-white py-3 px-6 rounded-xl font-semibold">
                                        üè† Back to Home
                                    </button>
                                </div>
                            </div>
                        </section>

                        <!-- Settings Section -->
                        <section id="settingsSection" class="hidden">
                            <div class="cartoon-card rounded-3xl p-8">
                                <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">‚öôÔ∏è Settings</h3>
                                <div class="bg-gray-50 rounded-xl p-6 text-center">
                                    <div class="text-5xl mb-4">üîß</div>
                                    <p class="text-gray-700 mb-4">Customize your learning experience!</p>
                                    <button onclick="showWelcome()" class="secondary-button text-white py-3 px-6 rounded-xl font-semibold">
                                        üè† Back to Home
                                    </button>
                                </div>
                            </div>
                        </section>
                    </main>
                </body>
            `;
            
            // Initialize the app AFTER the DOM is ready
            setTimeout(() => {
                initializeApp();
            }, 100);
        }

        // Initialize the main app
        function initializeApp() {
            console.log('üöÄ Initializing app...');
            updateUserStats();
            loadSavedGrade();
        }

        // Grade persistence functions (simulated since localStorage not available in sandbox)
        let savedUserData = {
            grade: '', // Will store the saved grade
            lastSave: null
        };

        // Save user grade
        function saveUserGrade(grade) {
            console.log(`üíæ Saving grade: ${grade}`);
            savedUserData.grade = grade;
            savedUserData.lastSave = new Date().toISOString();
            userStats.selectedGrade = grade;
        }

        // Load saved grade when app starts
        function loadSavedGrade() {
            console.log('üîç Loading saved grade...');
            
            if (savedUserData.grade) {
                console.log(`‚úÖ Found saved grade: ${savedUserData.grade}`);
                userStats.selectedGrade = savedUserData.grade;
                
                // Update the dropdown to show the saved grade
                const gradeSelect = document.getElementById('gradeSelect');
                if (gradeSelect) {
                    gradeSelect.value = savedUserData.grade;
                    console.log(`üìù Updated dropdown to: ${savedUserData.grade}`);
                }
                
                // Show a welcome back message for returning users
                setTimeout(() => {
                    showWelcomeBackMessage(savedUserData.grade);
                }, 1000);
            } else {
                console.log('üìã No saved grade found - new user');
            }
        }

        // Show welcome back message for returning users
        function showWelcomeBackMessage(grade) {
            // Create a small welcome back notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: linear-gradient(45deg, #10b981, #34d399);
                color: white;
                padding: 12px 20px;
                rounded: 12px;
                border-radius: 12px;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                z-index: 1000;
                animation: slideInRight 0.5s ease-out;
            `;
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            const gradeLabels = {
                'K1': 'üé® K1',
                'K2': 'üåà K2', 
                'K3': 'üé≠ K3',
                'Primary1': 'üìö P1',
                'Primary2': 'üî¢ P2',
                'Primary3': 'üß™ P3',
                'Primary4': 'üåü P4',
                'Primary5': 'üöÄ P5',
                'Primary6': 'üèÜ P6'
            };
            
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span>üëã</span>
                    <span>Welcome back! You're in ${gradeLabels[grade] || grade}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 4 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 4000);
        }

        // Update user stats display
        function updateUserStats() {
            const pointsEl = document.getElementById('userPoints');
            const levelEl = document.getElementById('userLevel');
            const streakEl = document.getElementById('streakCount');
            
            if (pointsEl) pointsEl.textContent = userStats.points;
            if (levelEl) levelEl.textContent = userStats.level;
            if (streakEl) streakEl.textContent = `${userStats.streak} day streak`;
        }

        // Show different sections
        function showSection(sectionId) {
            console.log(`üì± Showing section: ${sectionId}`);
            const sections = ['welcomeSection', 'quizSection', 'miniGamesSection', 'rewardsSection', 'progressSection', 'settingsSection'];
            sections.forEach(section => {
                const el = document.getElementById(section);
                if (el) {
                    if (section === sectionId) {
                        el.classList.remove('hidden');
                    } else {
                        el.classList.add('hidden');
                    }
                }
            });
        }

        // Navigation functions
        function showWelcome() {
            console.log('üè† Going to welcome section');
            showSection('welcomeSection');
        }

        function showMiniGames() {
            console.log('üéÆ Going to mini games');
            showSection('miniGamesSection');
        }

        function showRewards() {
            console.log('üéÅ Going to rewards');
            showSection('rewardsSection');
        }

        function showProgress() {
            console.log('üìä Going to progress');
            showSection('progressSection');
        }

        function showSettings() {
            console.log('‚öôÔ∏è Going to settings');
            showSection('settingsSection');
        }

        function startQuiz(subject) {
            console.log(`üìù Starting ${subject} quiz`);
            
            // Check if grade is selected
            const gradeSelect = document.getElementById('gradeSelect');
            if (!gradeSelect || !gradeSelect.value) {
                showGradeSelectionPopup(subject);
                return;
            }
            
            // Initialize quiz
            currentQuiz.subject = subject;
            currentQuiz.currentIndex = 0;
            currentQuiz.score = 0;
            currentQuiz.selectedAnswer = null;
            
            // Get questions for selected subject and grade
            const grade = userStats.selectedGrade;
            const questionsForGrade = sampleQuestions[subject] && sampleQuestions[subject][grade];
            
            if (questionsForGrade) {
                currentQuiz.questions = [...questionsForGrade];
            } else {
                // Fallback to K1 questions if specific grade not found
                currentQuiz.questions = [...(sampleQuestions[subject].K1 || [])];
            }
            
            // Reset quiz UI
            resetQuizUI();
            loadCurrentQuestion();
            showSection('quizSection');
        }

        // Show fun grade selection popup
        function showGradeSelectionPopup(subject) {
            console.log('üéì Showing grade selection popup...');
            
            // Remove any existing popup
            const existingPopup = document.getElementById('gradeSelectionPopup');
            if (existingPopup) {
                existingPopup.remove();
            }
            
            // Get subject emoji
            const subjectEmojis = {
                'Math': 'üî¢',
                'English': 'üìö', 
                'Science': 'üß™'
            };
            const subjectEmoji = subjectEmojis[subject] || 'üìñ';
            
            // Create the popup
            const popup = document.createElement('div');
            popup.id = 'gradeSelectionPopup';
            popup.style.cssText = `
                position: fixed; 
                top: 0; 
                left: 0; 
                width: 100%; 
                height: 100%; 
                background: rgba(0,0,0,0.5); 
                z-index: 9999; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                padding: 1rem;
            `;
            
            popup.innerHTML = `
                <div class="bg-gradient-to-br from-yellow-100 to-orange-100 rounded-3xl p-8 w-full max-w-md text-center relative overflow-hidden">
                    <!-- Close button -->
                    <button onclick="closeGradeSelectionPopup()" class="absolute top-4 right-4 w-10 h-10 bg-white/80 hover:bg-white rounded-full flex items-center justify-center text-2xl font-bold text-gray-600 hover:text-gray-800 z-10 shadow-lg">
                        √ó
                    </button>
                    
                    <!-- Fun header -->
                    <div class="text-6xl mb-4 animate-bounce">${subjectEmoji}</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">Ready for ${subject}? üöÄ</h2>
                    <p class="text-gray-600 mb-6">First, let me know what grade you're in so I can give you the perfect questions!</p>
                    
                    <!-- Grade buttons -->
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <button onclick="selectGradeAndStart('K1', '${subject}')" class="bg-gradient-to-r from-pink-400 to-red-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üé® K1<br><span class="text-sm">(Ages 3-4)</span>
                        </button>
                        <button onclick="selectGradeAndStart('K2', '${subject}')" class="bg-gradient-to-r from-purple-400 to-pink-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üåà K2<br><span class="text-sm">(Ages 4-5)</span>
                        </button>
                        <button onclick="selectGradeAndStart('K3', '${subject}')" class="bg-gradient-to-r from-blue-400 to-purple-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üé≠ K3<br><span class="text-sm">(Ages 5-6)</span>
                        </button>
                        <button onclick="selectGradeAndStart('Primary1', '${subject}')" class="bg-gradient-to-r from-green-400 to-blue-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üìö P1
                        </button>
                        <button onclick="selectGradeAndStart('Primary2', '${subject}')" class="bg-gradient-to-r from-yellow-400 to-green-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üî¢ P2
                        </button>
                        <button onclick="selectGradeAndStart('Primary3', '${subject}')" class="bg-gradient-to-r from-orange-400 to-yellow-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üß™ P3
                        </button>
                        <button onclick="selectGradeAndStart('Primary4', '${subject}')" class="bg-gradient-to-r from-red-400 to-orange-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üåü P4
                        </button>
                        <button onclick="selectGradeAndStart('Primary5', '${subject}')" class="bg-gradient-to-r from-indigo-400 to-red-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üöÄ P5
                        </button>
                        <button onclick="selectGradeAndStart('Primary6', '${subject}')" class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-3 px-4 rounded-xl font-semibold hover:scale-105 transition-transform">
                            üèÜ P6
                        </button>
                    </div>
                    
                    <p class="text-sm text-gray-500">Don't worry, you can always change this later! üòä</p>
                </div>
            `;
            
            document.body.appendChild(popup);
        }

        // Close grade selection popup
        function closeGradeSelectionPopup() {
            const popup = document.getElementById('gradeSelectionPopup');
            if (popup) {
                popup.remove();
            }
        }

        // Select grade and go back to home
        function selectGradeAndStart(grade, subject) {
            console.log(`üéØ Selected grade ${grade} for ${subject}`);
            
            // Save the grade
            userStats.selectedGrade = grade;
            saveUserGrade(grade);
            
            // Update the dropdown
            const gradeSelect = document.getElementById('gradeSelect');
            if (gradeSelect) {
                gradeSelect.value = grade;
            }
            
            // Close popup
            closeGradeSelectionPopup();
            
            // Show a success message and go back to home
            setTimeout(() => {
                showSuccessMessage(grade);
                showSection('welcomeSection');
            }, 300);
        }

        // Show success message after grade selection
        function showSuccessMessage(grade) {
            const gradeLabels = {
                'K1': 'üé® K1',
                'K2': 'üåà K2', 
                'K3': 'üé≠ K3',
                'Primary1': 'üìö P1',
                'Primary2': 'üî¢ P2',
                'Primary3': 'üß™ P3',
                'Primary4': 'üåü P4',
                'Primary5': 'üöÄ P5',
                'Primary6': 'üèÜ P6'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: linear-gradient(45deg, #10b981, #34d399);
                color: white;
                padding: 12px 20px;
                border-radius: 12px;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                z-index: 1000;
                animation: slideInRight 0.5s ease-out;
            `;
            
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span>‚úÖ</span>
                    <span>Great! You're set for ${gradeLabels[grade] || grade}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        function saveSelectedGrade() {
            const gradeSelect = document.getElementById('gradeSelect');
            if (gradeSelect) {
                userStats.selectedGrade = gradeSelect.value;
                console.log(`üìö Grade selected: ${userStats.selectedGrade}`);
            }
        }



        // Quiz functionality
        let currentQuiz = {
            subject: '',
            questions: [],
            currentIndex: 0,
            score: 0,
            selectedAnswer: null
        };

        // Sample questions for different subjects and grades
        const sampleQuestions = {
            Math: {
                K1: [
                    { question: "How many fingers do you have on one hand?", options: ["3", "5", "7", "10"], correct: 1 },
                    { question: "What comes after the number 2?", options: ["1", "3", "4", "5"], correct: 1 },
                    { question: "Which is bigger: üêò or üê≠?", options: ["üê≠ Mouse", "üêò Elephant", "Same size", "Don't know"], correct: 1 },
                    { question: "Count the stars: ‚≠ê‚≠ê‚≠ê", options: ["2", "3", "4", "5"], correct: 1 },
                    { question: "What is 1 + 1?", options: ["1", "2", "3", "4"], correct: 1 }
                ],
                Primary1: [
                    { question: "What is 5 + 3?", options: ["6", "7", "8", "9"], correct: 2 },
                    { question: "What is 10 - 4?", options: ["5", "6", "7", "8"], correct: 1 },
                    { question: "How many sides does a triangle have?", options: ["2", "3", "4", "5"], correct: 1 },
                    { question: "What is 2 √ó 3?", options: ["5", "6", "7", "8"], correct: 1 },
                    { question: "What is 15 √∑ 3?", options: ["3", "4", "5", "6"], correct: 2 }
                ]
            },
            English: {
                K1: [
                    { question: "What sound does a cat make?", options: ["Woof", "Meow", "Moo", "Roar"], correct: 1 },
                    { question: "Which letter comes after 'A'?", options: ["C", "B", "D", "E"], correct: 1 },
                    { question: "What color is the sun?", options: ["Blue", "Yellow", "Green", "Purple"], correct: 1 },
                    { question: "How many letters are in 'CAT'?", options: ["2", "3", "4", "5"], correct: 1 },
                    { question: "What do we use to write?", options: ["Spoon", "Pen", "Cup", "Shoe"], correct: 1 }
                ],
                Primary1: [
                    { question: "Which word rhymes with 'cat'?", options: ["dog", "hat", "fish", "bird"], correct: 1 },
                    { question: "What is the opposite of 'big'?", options: ["large", "small", "huge", "tall"], correct: 1 },
                    { question: "Which is a complete sentence?", options: ["Running fast", "The dog barks", "Blue sky", "Happy birthday"], correct: 1 },
                    { question: "What type of word is 'jump'?", options: ["noun", "verb", "color", "number"], correct: 1 },
                    { question: "Which word is a noun?", options: ["run", "happy", "book", "quickly"], correct: 2 }
                ]
            },
            Science: {
                K1: [
                    { question: "What do plants need to grow?", options: ["Toys", "Water", "Candy", "TV"], correct: 1 },
                    { question: "Which animal lives in water?", options: ["Cat", "Fish", "Dog", "Bird"], correct: 1 },
                    { question: "What gives us light during the day?", options: ["Moon", "Sun", "Stars", "TV"], correct: 1 },
                    { question: "How many legs does a spider have?", options: ["6", "8", "10", "4"], correct: 1 },
                    { question: "What do we breathe?", options: ["Water", "Air", "Food", "Juice"], correct: 1 }
                ],
                Primary1: [
                    { question: "What are the three states of matter?", options: ["Hot, cold, warm", "Solid, liquid, gas", "Big, small, medium", "Red, blue, green"], correct: 1 },
                    { question: "What planet do we live on?", options: ["Mars", "Earth", "Jupiter", "Venus"], correct: 1 },
                    { question: "What makes plants green?", options: ["Water", "Chlorophyll", "Soil", "Air"], correct: 1 },
                    { question: "How many bones are in an adult human body?", options: ["106", "206", "306", "406"], correct: 1 },
                    { question: "What gas do plants give off?", options: ["Carbon dioxide", "Oxygen", "Nitrogen", "Hydrogen"], correct: 1 }
                ]
            }
        };

        // Reset quiz UI to initial state
        function resetQuizUI() {
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('nextButton').disabled = true;
        }

        // Load current question
        function loadCurrentQuestion() {
            const question = currentQuiz.questions[currentQuiz.currentIndex];
            const totalQuestions = currentQuiz.questions.length;
            const progress = ((currentQuiz.currentIndex + 1) / totalQuestions) * 100;
            
            // Update progress bar
            document.getElementById('quizProgress').style.width = progress + '%';
            document.getElementById('currentQuestionNum').textContent = currentQuiz.currentIndex + 1;
            document.getElementById('totalQuestions').textContent = totalQuestions;
            
            // Update question text
            document.getElementById('questionText').textContent = question.question;
            
            // Update answer options
            const optionsContainer = document.getElementById('answerOptions');
            const letters = ['A', 'B', 'C', 'D'];
            
            optionsContainer.innerHTML = question.options.map((option, index) => `
                <button class="answer-option w-full text-left p-4 rounded-xl border-2 border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200" onclick="selectAnswer(${index}, this)">
                    <span class="font-semibold text-blue-600 mr-3">${letters[index]})</span> ${option}
                </button>
            `).join('');
            
            // Reset selection
            currentQuiz.selectedAnswer = null;
            document.getElementById('nextButton').disabled = true;
        }

        // Select an answer
        function selectAnswer(answerIndex, buttonElement) {
            // Prevent multiple selections
            if (currentQuiz.selectedAnswer !== null) return;
            
            // Store selection
            currentQuiz.selectedAnswer = answerIndex;
            
            // Get correct answer
            const currentQuestion = currentQuiz.questions[currentQuiz.currentIndex];
            const correctIndex = currentQuestion.correct;
            const isCorrect = answerIndex === correctIndex;
            
            // Disable all option buttons to prevent further clicks
            document.querySelectorAll('.answer-option').forEach(btn => {
                btn.style.pointerEvents = 'none';
            });
            
            // Show immediate feedback
            document.querySelectorAll('.answer-option').forEach((btn, index) => {
                if (index === correctIndex) {
                    // Highlight correct answer in green
                    btn.classList.remove('border-gray-200', 'hover:border-blue-400', 'hover:bg-blue-50');
                    btn.classList.add('border-green-500', 'bg-green-100');
                    btn.innerHTML = btn.innerHTML + ' <span class="float-right text-green-600 font-bold">‚úì Correct</span>';
                } else if (index === answerIndex && !isCorrect) {
                    // Highlight selected wrong answer in red
                    btn.classList.remove('border-gray-200', 'hover:border-blue-400', 'hover:bg-blue-50');
                    btn.classList.add('border-red-500', 'bg-red-100');
                    btn.innerHTML = btn.innerHTML + ' <span class="float-right text-red-600 font-bold">‚úó Wrong</span>';
                } else {
                    // Gray out other options
                    btn.classList.add('opacity-50');
                }
            });
            
            // Update score immediately if correct
            if (isCorrect) {
                currentQuiz.score++;
            }
            
            // Change button text and enable it
            const nextButton = document.getElementById('nextButton');
            if (currentQuiz.currentIndex < currentQuiz.questions.length - 1) {
                nextButton.textContent = 'Continue ‚Üí';
            } else {
                nextButton.textContent = 'See Results üéâ';
            }
            nextButton.disabled = false;
            
            // Show encouraging message
            setTimeout(() => {
                showFeedbackMessage(isCorrect);
            }, 500);
        }

        // Show feedback message
        function showFeedbackMessage(isCorrect) {
            const existingMessage = document.getElementById('feedbackMessage');
            if (existingMessage) existingMessage.remove();
            
            const message = document.createElement('div');
            message.id = 'feedbackMessage';
            message.style.cssText = `
                position: fixed;
                top: 120px;
                left: 50%;
                transform: translateX(-50%);
                padding: 12px 24px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 1000;
                animation: feedbackSlide 0.5s ease-out;
            `;
            
            if (isCorrect) {
                message.style.background = 'linear-gradient(45deg, #10b981, #34d399)';
                message.style.color = 'white';
                message.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-xl">üéâ</span>
                        <span>Excellent! That's correct!</span>
                    </div>
                `;
            } else {
                message.style.background = 'linear-gradient(45deg, #f59e0b, #fbbf24)';
                message.style.color = 'white';
                message.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-xl">üí°</span>
                        <span>Good try! Let's learn from this!</span>
                    </div>
                `;
            }
            
            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes feedbackSlide {
                    from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(message);
            
            // Remove message after 2 seconds
            setTimeout(() => {
                if (message.parentNode) {
                    message.remove();
                }
            }, 2000);
        }

        // Go to next question
        function nextQuestion() {
            if (currentQuiz.selectedAnswer === null) return;
            
            // Check if answer is correct
            const currentQuestion = currentQuiz.questions[currentQuiz.currentIndex];
            if (currentQuiz.selectedAnswer === currentQuestion.correct) {
                currentQuiz.score++;
            }
            
            // Move to next question or show results
            currentQuiz.currentIndex++;
            
            if (currentQuiz.currentIndex >= currentQuiz.questions.length) {
                showQuizResults();
            } else {
                loadCurrentQuestion();
            }
        }

        // Show quiz results
        function showQuizResults() {
            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            const score = currentQuiz.score;
            const total = currentQuiz.questions.length;
            const pointsEarned = score * 10; // 10 points per correct answer
            
            // Update stats
            userStats.points += pointsEarned;
            userStats.totalQuestionsAnswered += total;
            userStats.correctAnswers += score;
            
            // Update level if needed
            if (userStats.points >= userStats.level * 100) {
                userStats.level++;
            }
            
            // Update UI
            document.getElementById('finalScore').textContent = `${score}/${total}`;
            document.getElementById('pointsEarned').textContent = `${pointsEarned} points`;
            
            // Update header stats
            updateUserStats();
        }

        // Start a new quiz
        function startNewQuiz() {
            showWelcome();
        }

        // Auto-start main app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üì± Page loaded - auto-starting app...');
            setTimeout(() => {
                showFullApp();
            }, 1000);
        });
    </script>
</body>
</html>